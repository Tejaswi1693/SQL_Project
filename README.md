# SQL_Project
**FINANCE ANALYTICS,TOP CUSTOMERS, MARKETS, PRODUCTS**

**PROJECT OVERVIEW**

1. AtliQ Hardware Is A Global Computer Hardware Manufacturer That Specializes In Producing High-Performance Computer Components And Peripherals.
2. The Company Operates Across Major International Markets, Including Apac (Asia- Pacific), Eu (Europe), Na (North America), And Latam (Latin America).
3. Atliq’s Product Portfolio Includes Processors, Motherboards, Graphics Cards, Ram, Storage Solutions (Ssds, Hdds),And Peripherals Such As Keyboards, Mice, And Monitors.
4. With A Commitment To Innovation And Quality, The Company Caters To Both Individual Consumers And Businesses, Ensuring Reliable And Efficient Hardware Solutions For          Diverse Computing Needs.

**PROBLEM STATEMENT**

1. Performance Challenges with Large Excel Files – AtliQ Hardware is facing inefficiencies and slow performance due to the increasing size of Excel files.
2. Expanding Data Analytics Team – To address this issue, the company is hiring junior data analysts to strengthen its data analytics capabilities.
3. Transition to MySQL – AtliQ is utilizing MySQL as its database management system to analyze data, track financial trends, and extract meaningful insights.
4. Business Optimization Goals – The project aims to enhance decision-making, streamline operations, and improve overall company performance.

**TASK - 1**

In order to track individual product sales and perform additional product analytics on it using Excel,
I, as the product owner, would like to create a report of Croma India customers' sales of individual products (aggregated monthly at the product code level) for FY-2021.

The following fields should be included in the report:
Month
Product Name
Variant
Sold Quantity
Gross Price Per Item
Gross Price Tota1

**DATASET**

LOADED A MILLION ROWS OF DATA INTO A MYSQL DATABASE AND EXECUTED MULTIPLE QUERIES.
ANALYZED THE FOLLOWING TABLES TO DERIVE THE SQL CONCEPTS PRESENTED.

  <img width="298" height="193" alt="sql_1" src="https://github.com/user-attachments/assets/a6d548d4-e29b-4079-95ad-4a8f1776821d" />



**FUNCTIONS CREATED**

VIEWS
STORED PROCEDURE
FUNCTIONS

  <img width="263" height="217" alt="sql_2" src="https://github.com/user-attachments/assets/ef574838-8275-4093-9640-669435777ebc" />

**FINANCE ANALYTICS**

1.FIRST GRAB CUSTOMER CODES FOR CROMA INDIA
  QUERY: SELECT * FROM DIM_CUSTOMER 
  WHERE CUSTOMER LIKE "%CROMA%" AND MARKET=“INDIA"
  
  <img width="455" height="47" alt="sql_3" src="https://github.com/user-attachments/assets/8ed5e7ac-018e-4db5-a978-144f6eac4ddb" />

2.GET ALL THE SALES TRANSACTION DATA FROM FACT_SALES_MONTHLY TABLE FOR THAT CUSTOMER(CROMA: 90002002) IN THE FISCAL_YEAR 2021.
  QUERY: 
  SELECT * FROM FACT_SALES_MONTHLY 
  WHERE CUSTOMER_CODE=90002002 AND YEAR(DATE_ADD(DATE, INTERVAL 4 MONTH))=2021 
  ORDER BY DATE ASC LIMIT 100000
  
  <img width="476" height="137" alt="sql_4" src="https://github.com/user-attachments/assets/8adeb263-b05e-4be4-b01f-b6be09710eae" />

3.CREATE A FUNCTION 'GET_FISCAL_YEAR' TO GET FISCAL YEAR BY PASSING THE DATE

  CREATE FUNCTION `GET_FISCAL_YEAR`(CALENDAR_DATE DATE) RETURNS INT DETERMINISTIC
  BEGIN
  DECLARE FISCAL_YEAR INT; SET FISCAL_YEAR = YEAR
  (DATE_ADD(CALENDAR_DATE,
  INTERVAL 4 MONTH)); RETURN FISCAL_YEAR; 
  END
  
  <img width="390" height="179" alt="sql_5" src="https://github.com/user-attachments/assets/dfa7cbbc-fd4a-4896-b3a1-3a8297f413de" />

4.REPLACING THE FUNCTION CREATED IN THE STEP:B

  QUERY: 
  SELECT * FROM FACT_SALES_MONTHLY
  WHERE CUSTOMER_CODE=90002002 AND GET_FISCAL_YEAR(DATE)=2021 
  ORDER BY DATE ASC LIMIT 100000;
  
  <img width="449" height="250" alt="sql_6" src="https://github.com/user-attachments/assets/4066094b-ea6d-4f1c-bae1-4793604e5063" />

**MODULE:** GROSS SALES REPORT: MONTHLY PRODUCT TRANSACTIONS

 1.PERFORM JOINS TO PULL PRODUCT INFORMATION
 
 SELECT S.DATE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY 
 FROM FACT_SALES_MONTHLY S 
 JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE 
 WHERE CUSTOMER_CODE=90002002 AND GET_FISCAL_YEAR(DATE)=2021 LIMIT 1000000;  
 
 <img width="399" height="160" alt="sql_7" src="https://github.com/user-attachments/assets/cd38dcb3-9f15-4fca-a15f-6a12373d9129" />
 
 2.PERFORMING JOIN WITH 'FACT_GROSS_PRICE' TABLE WITH THE ABOVE QUERY AND GENERATING REQUIRED FIELDS

 SELECT S.DATE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY, G.GROSS_PRICE, ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL 
 FROM FACT_SALES_MONTHLY S 
 JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE 
 JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=GET_FISCAL_YEAR(S.DATE) AND G.PRODUCT_CODE=S.PRODUCT_CODE 
 WHERE CUSTOMER_CODE=90002002 AND GET_FISCAL_YEAR(S.DATE)=2021 LIMIT 1000000;
 
 <img width="465" height="179" alt="sql_8" src="https://github.com/user-attachments/assets/977e287c-80e6-44db-b32c-0db6e24f71be" />

 **MODULE**: GROSS SALES REPORT:TOTAL SALES AMOUNT

GENERATE MONTHLY GROSS SALES REPORT FOR CROMA INDIA FOR ALL THE YEARS

SELECT S.DATE, SUM(ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2)) AS MONTHLY_SALES 
FROM FACT_SALES_MONTHLY S 
JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=GET_FISCAL_YEAR(S.DATE) AND G.PRODUCT_CODE=S.PRODUCT_CODE 
WHERE CUSTOMER_CODE=90002002 
GROUP BY DATE;

<img width="172" height="192" alt="sql_9" src="https://github.com/user-attachments/assets/083b767f-97b3-466b-9061-3d8962b280e4" />

**MODULE:** STORED PROCEDURES: MONTHLY GROSS SALES REPORT GENERATE MONTHLY 
GROSS SALES REPORT FOR ANY CUSTOMER USING STORED PROCEDURE

<img width="464" height="252" alt="sql_10" src="https://github.com/user-attachments/assets/58f1393b-ba32-4a58-a7e3-0c537b350f71" />

**MODULE:** STORED PROCEDURE: MARKET BADGE

<img width="457" height="329" alt="sql_11" src="https://github.com/user-attachments/assets/530f78b2-e310-4ab4-aeb1-9072e71efc89" />

**TOP CUSTOMERS, PRODUCTS, MARKETS**

**TASK :- 2**
1.REPORT FOR TOP MARKET
2.REPORT FOR TOP PRODUCTS
3.REPORT FOR TOP CUSTOMERS

**MODULE:** PROBLEM STATEMENT AND PRE-INVOICE DISCOUNT REPORT
INCLUDE PRE-INVOICE DEDUCTIONS IN CROMA DETAILED REPORT

SELECT S.DATE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY, G.GROSS_PRICE AS GROSS_PRICE_PER_ITEM,
ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL, PRE.PRE_INVOICE_DISCOUNT_PCT 
FROM FACT_SALES_MONTHLY S 
JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE 
JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=GET_FISCAL_YEAR(S.DATE) AND G.PRODUCT_CODE=S.PRODUCT_CODE
JOIN FACT_PRE_INVOICE_DEDUCTIONS AS PRE ON PRE.CUSTOMER_CODE = S.CUSTOMER_CODE AND PRE.FISCAL_YEAR=GET_FISCAL_YEAR(S.DATE) 
WHERE S.CUSTOMER_CODE=90002002 AND GET_FISCAL_YEAR(S.DATE)=2021 LIMIT 1000000;

**PERFORMANCE IMPROVEMENT # 1**
CREATING DIM_DATE AND JOINING WITH THIS TABLE AND AVOID USING THE FUNCTION 'GET_FISCAL_YEAR()' TO REDUCE THE AMOUNT OF TIME TAKING TO RUN THE QUERY

SELECT S.DATE, S.CUSTOMER_CODE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY,
G.GROSS_PRICE AS GROSS_PRICE_PER_ITEM, ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL, PRE.PRE_INVOICE_DISCOUNT_PCT
FROM FACT_SALES_MONTHLY S 
JOIN DIM_DATE DT ON DT.CALENDAR_DATE = S.DATE
JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=DT.FISCAL_YEAR AND G.PRODUCT_CODE=S.PRODUCT_CODE 
JOIN FACT_PRE_INVOICE_DEDUCTIONS AS PRE ON PRE.CUSTOMER_CODE = S.CUSTOMER_CODE AND PRE.FISCAL_YEAR=DT.FISCAL_YEAR 
WHERE DT.FISCAL_YEAR=2021 MODULE LIMIT 1000000

<img width="449" height="231" alt="sql_12" src="https://github.com/user-attachments/assets/49be080d-d4df-41ae-8489-b9e43d24828d" />

 **PERFORMANCE IMPROVEMENT # 2**
ADDED THE FISCAL YEAR IN THE FACT_SALES_MONTHLY TABLE ITSELF

SELECT S.DATE, S.CUSTOMER_CODE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY,
G.GROSS_PRICE AS GROSS_PRICE_PER_ITEM, ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL, PRE.PRE_INVOICE_DISCOUNT_PCT
FROM FACT_SALES_MONTHLY S
JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE 
JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=S.FISCAL_YEAR AND G.PRODUCT_CODE=S.PRODUCT_CODE
JOIN FACT_PRE_INVOICE_DEDUCTIONS AS PRE ON PRE.CUSTOMER_CODE = S.CUSTOMER_CODE AND PRE.FISCAL_YEAR=S.FISCAL_YEAR 
WHERE S.FISCAL_YEAR=2021 LIMIT 1500000

<img width="432" height="215" alt="sql_13" src="https://github.com/user-attachments/assets/ea0a8ce0-c591-4437-96d9-dfa41de6fad0" />

**DATABASE VIEWS**

GET THE NET_INVOICE_SALES AMOUNT USING THE CTE’S

WITH CTE1 AS (
SELECT S.DATE,
S.CUSTOMER_CODE, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY,
G.GROSS_PRICE AS GROSS_PRICE_PER_ITEM, ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL, PRE.PRE_INVOICE_DISCOUNT_PCT
FROM FACT_SALES_MONTHLY S
JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE 
JOIN FACT_GROSS_PRICE G ON G.FISCAL_YEAR=S.FISCAL_YEAR AND G.PRODUCT_CODE=S.PRODUCT_CODE 
JOIN FACT_PRE_INVOICE_DEDUCTIONS AS PRE ON PRE.CUSTOMER_CODE = S.CUSTOMER_CODE AND PRE.FISCAL_YEAR=S.FISCAL_YEAR 
WHERE S.FISCAL_YEAR=2021)
SELECT *,
(gross_price_total pre_invoice_discount_pct_*gross_price_total) as net_invoice_sales FROM cte1

<img width="431" height="181" alt="sql_14" src="https://github.com/user-attachments/assets/3b5360e1-ed4d-417f-bca2-49b09ec482c9" />

**CREATING THE VIEW `SALES_PREINV_DISCOUNT` AND STORE ALL THE DATA IN LIKE A VIRTUAL TABLE**

CREATE VIEW `SALES_PREINV_DISCOUNT` AS
SELECT S.DATE, S.FISCAL_YEAR,S.CUSTOMER_CODE, C.MARKET, S.PRODUCT_CODE, P.PRODUCT, P.VARIANT, S.SOLD_QUANTITY,
G.GROSS_PRICE AS GROSS_PRICE_PER_ITEM, ROUND(S.SOLD_QUANTITY*G.GROSS_PRICE,2) AS GROSS_PRICE_TOTAL, PRE.PRE_INVOICE_DISCOUNT_PCT
FROM FACT_SALES_MONTHLY S 
JOIN DIM_CUSTOMER C ON S.CUSTOMER_CODE = C.CUSTOMER_CODE
JOIN DIM_PRODUCT P ON S.PRODUCT_CODE=P.PRODUCT_CODE
JOIN FACT_GROSS_PRICE ON G.FISCAL_YEAR=S.FISCAL_YEAR AND G.PRODUCT_CODE=S.PRODUCT_CODE	
JOIN fact_pre_invoice_deductions as pre ON pre.customer_code = s.customer_code AND pre.fiscal_year=s.fiscal_year

<img width="463" height="271" alt="sql_15" src="https://github.com/user-attachments/assets/946e8139-482e-45a9-bdc0-2ee362fda1b7" />

**DATABASE VIEWS: POST INVOICE DISCOUNT, NET SALES **
CREATE A VIEW FOR POST INVOICE DEDUCTIONS: `SALES_POSTINV_DISCOUNT` 
CREATE VIEW `SALES_POSTINV_DISCOUNT` AS
SELECT
S.DATE, S.FISCAL_YEAR, S.CUSTOMER_CODE, S.MARKET, S.PRODUCT_CODE, S.PRODUCT, S.VARIANT, S.SOLD_QUANTITY, S.GROSS_PRICE_TOTAL, S.PRE_INVOICE_DISCOUNT_PCT,
(S.GROSS_PRICE_TOTAL-S.PRE_INVOICE_DISCOUNT_PCT*S.GROSS_PRICE_TOTAL) AS NET_INVOICE_SALES, (PO.DISCOUNTS_PCT+PO.OTHER_DEDUCTIONS_PCT) AS POST_INVOICE_DISCOUNT_PCT
FROM SALES_PREINV_DISCOUNT S
JOIN FACT_POST_INVOICE_DEDUCTIONS PO ON PO.CUSTOMER_CODE = S.CUSTOMER_CODE AND PO.PRODUCT_CODE = S.PRODUCT_CODE AND PO.DATE = S.DATE;

<img width="428" height="248" alt="sql_16" src="https://github.com/user-attachments/assets/95ee43e0-be90-4bf2-b955-d8a730268b01" />

**CREATE A REPORT FOR NET SALES**

SELECT *,NET_INVOICE_SALES*(1-POST_INVOICE_DISCOUNT_PCT) AS NET_SALES FROM GDB0041.SALES_POSTINV_DISCOUNT;

CREATING THE `NET_SALES` VIEW WHICH INCLUDE ALL THE PREVIOUS CREATED VIEW AND GIVES THE FINAL RESULT

CREATE VIEW `NET_SALES` AS
SELECT *,NET_INVOICE_SALES*(1-POST_INVOICE_DISCOUNT_PCT) AS NET_SALES
FROM GDB0041.SALES_POSTINV_DISCOUNT;

<img width="442" height="200" alt="sql_17" src="https://github.com/user-attachments/assets/ce84a776-eb13-42b7-8dab-666fa843c06d" />

**STORED PROC TO GET TOP N MARKETS BY NET SALES FOR A GIVEN YEAR**

<img width="481" height="215" alt="sql_18" src="https://github.com/user-attachments/assets/ae73e5e6-3f3b-48d0-b297-d627e9215809" />

**STORED PROCEDURE THAT TAKES MARKET, FISCAL_YEAR AND TOP N AS AN INPUT AND RETURNS TOP N CUSTOMERS BY NET**
SALES IN THAT GIVEN FISCAL YEAR AND MARKET.

CREATE PROCEDURE `GET_TOP_N_CUSTOMERS_BY_NET_SALES`(
IN_MARKET VARCHAR(45), IN_FISCAL_YEAR INT, IN_TOP_N INT
) BEGIN 
SELECT CUSTOMER,ROUND(SUM(NET_SALES)/1000000,2) AS NET_SALES_MLN 
FROM NET_SALES S
JOIN DIM_CUSTOMER C ON S.CUSTOMER_CODE=C.CUSTOMER_CODE
WHERE S.FISCAL_YEAR=IN_FISCAL_YEAR AND S.MARKET=IN_MARKET 
GROUP BY CUSTOMER
ORDER BY NET_SALES_MLN DESC
LIMIT IN_TOP_N; 
END

<img width="475" height="212" alt="sql_19" src="https://github.com/user-attachments/assets/e7914099-5c54-4be3-89ab-ee654d0098a3" />

**WINDOW FUNCTIONS: OVER CLAUSE**
SHOW % OF TOTAL EXPENSE PER CATEGORY

<img width="387" height="229" alt="sql_20" src="https://github.com/user-attachments/assets/ecfed00d-0af4-4115-b0f7-26b2002e666c" />

SHOW EXPENSES PER CATEGORY TILL DATE


<img width="425" height="209" alt="sql_21" src="https://github.com/user-attachments/assets/549e8f4d-5f0f-40c0-ac4c-f36dc6c9729a" />


**WINDOW FUNCTIONS: OVER CLAUSE**
FIND CUSTOMER WISE NET SALES DISTRIBUTION PER REGION FOR FY 2021.

WITH CTE1 AS ( SELECT C.CUSTOMER, C.REGION,
ROUND(SUM(NET_SALES)/1000000,2) AS NET_SALES_MLN FROM GDB0041.NET_SALES N
JOIN DIM_CUSTOMER C
ON N.CUSTOMER_CODE=C.CUSTOMER_CODE
WHERE FISCAL_YEAR=2021
GROUP BY C.CUSTOMER, C.REGION)
SELECT *,
NET_SALES_MLN*100/SUM(NET_SALES_MLN) OVER (PARTITION BY REGION) AS PCT_SHARE_REGION
FROM CTE1
ORDER BY REGION, PCT_SHARE_REGION DESC


<img width="254" height="178" alt="sql_22" src="https://github.com/user-attachments/assets/ee3408f8-ddfa-4280-a52c-6ec7a4852f07" />


**WINDOW FUNCTIONS: ROW_NUMBER, RANK, DENSE_RANK**
FIND OUT TOP 3 PRODUCTS FROM EACH DIVISION BY TOTAL QUANTITY SOLD IN A GIVEN YEAR

WITH CTE1 AS (SELECT
P.DIVISION, P.PRODUCT,SUM(SOLD_QUANTITY) AS TOTAL_QTY 
FROM FACT_SALES_MONTHLY S
JOIN DIM_PRODUCT P ON P.PRODUCT_CODE=S.PRODUCT_CODE 
WHERE FISCAL_YEAR=2021
GROUP BY P.PRODUCT),
CTE2 AS
(SELECT
*,
DENSE_RANK() OVER (PARTITION BY DIVISION ORDER BY TOTAL_QTY DESC) AS DRNK
FROM CTE1)
SELECT * FROM CTE2 WHERE DRNK<=3



**CREATING STORED PROCEDURE FOR THE ABOVE QUERY**

CREATE PROCEDURE `GET_TOP_N_PRODUCTS_PER_DIVISION_BY_QTY_SOLD`(
IN_FISCAL_YEAR INT,
IN_TOP_N INT
)
BEGIN
WITH CTE1 AS ( 
SELECT P.DIVISION,P.PRODUCT,SUM(SOLD_QUANTITY) AS TOTAL_QTY
FROM FACT_SALES_MONTHLY S
JOIN DIM_PRODUCT P
ON P.PRODUCT_CODE=S.PRODUCT_CODE WHERE FISCAL_YEAR=IN_FISCAL_YEAR GROUP BY P.PRODUCT),
cte2 as (
select	*,
dense_rank() over (partition by division order by total_qty desc) as drnk
from cte1)
select * from cte2 where drnk <= in_top_n; 
END








































